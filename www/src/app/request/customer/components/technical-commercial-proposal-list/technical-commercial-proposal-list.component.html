<ng-container *ngIf="request$ | async"></ng-container>
<ng-container *ngIf="(stateStatus$ | async) !== 'fetching'; else placeholder">
  <div class="app-row">
    <div class="app-col">
      <div class="app-row app-align-items-center" [class.app-layout]="view === 'grid'">

        <uxg-tabs class="app-col">
          <uxg-tab-title #sentToReviewTab [active]="true" >
            <ng-container *ngIf="(proposalsSentToReview$ | async) as proposals">
              Необходимо рассмотреть <span class="counter">({{proposals?.length}})</span>
            </ng-container>
          </uxg-tab-title>

          <uxg-tab-title #sendToEditTab [disabled]="(proposalsSendToEdit$ | async).length === 0">
            <ng-container *ngIf="(proposalsSendToEdit$ | async) as proposals">
              На доработке <span class="counter">({{ proposals?.length }})</span>
            </ng-container>
          </uxg-tab-title>

          <uxg-tab-title #reviewedTab [disabled]="(proposalsReviewed$ | async).length === 0">
            <ng-container *ngIf="(proposalsReviewed$ | async) as proposals">
              Рассмотренные <span class="counter">({{ proposals?.length }})</span>
            </ng-container>
          </uxg-tab-title>
        </uxg-tabs>

        <ng-container *ngIf="(proposals$ | async).length">
          <div class="app-secondary-color">Режим отображения:</div>
          <div class="app-btn-group">
            <button uxgButton [primary]="view==='grid'" [secondary]="view==='list'" icon (click)="switchView('grid')">
              <uxg-icon shape="app-grid-view"></uxg-icon>
            </button>
            <button uxgButton [primary]="view==='list'" [secondary]="view==='grid'" icon (click)="switchView('list')">
              <uxg-icon shape="app-list-view"></uxg-icon>
            </button>
          </div>
          <!--  <button uxgButton secondary>Фильтр</button> -->
        </ng-container>
      </div>

      <br/>

      <ng-container [ngSwitch]="view" *ngIf="(reviewedTab.active ? proposalsReviewed$ : sentToReviewTab.active ? proposalsSentToReview$ : proposalsSendToEdit$) | async as proposalsByPos">
        <!-- grid -->
        <div class="grid-table" *ngSwitchCase="'grid'">
          <app-grid-contragents
            *ngIf="proposalsByPos.length"
            [gridRows]="gridRows"
            [suppliers]="suppliers(proposals$ | async)"
            [hasAnalogsFn]="hasAnalogs(proposals$ | async)"
          ></app-grid-contragents>

          <app-request-technical-commercial-proposal
            class="position-row"
            #proposalOnReview
            [chooseBy$]="chooseBy$"
            [proposals]="proposals$ | async"
            *ngFor="let positionProposals of proposalsByPos; trackBy: trackByPositionId"
            [requestId]="requestId"
            [view]="'grid'"
            [proposalByPos]="positionProposals">
          </app-request-technical-commercial-proposal>
        </div>

        <!-- list -->
        <ng-container *ngSwitchCase="'list'">
          <app-request-technical-commercial-proposal
            #proposalOnReview
            [chooseBy$]="chooseBy$"
            *ngFor="let positionProposals of proposalsByPos; trackBy: trackByPositionId"
            [requestId]="requestId"
            [view]="'list'"
            [proposalByPos]="positionProposals">
          </app-request-technical-commercial-proposal>
        </ng-container>

        <!-- empty -->
        <div *ngIf="proposalsByPos.length === 0">
          <h1 class="text-center" [style.opacity]="0.1">
            <br/>
            <uxg-icon shape="app-publish" size="270"></uxg-icon><br/>
            Все технико-коммерческие предложения рассмотрены
          </h1>
        </div>

      </ng-container>
    </div>
    <div class="app-col-aside detachable" *ngIf="view==='list'"></div>
  </div>
</ng-container>

<app-grid-footer
  [disabled]="(stateStatus$ | async) !== 'received' || disabled"
  [loading]="(stateStatus$ | async) !== 'received'"
  (approve)="approveMultiple()"
  (sendToEdit)="sendToEditAll()"
  [chooseBy$]="chooseBy$"
  [hidden]="!sentToReviewTab?.active || proposalsOnReview?.length === 0"
  [total]="total"
></app-grid-footer>

<ng-template #placeholder>
  <div class="app-row" [class.app-layout]="view === 'grid'">
    <div class="app-col">
      <div class="app-row">
        <div class="app-col app-row">
          <div class="placeholder-row" *ngFor="let i of [].constructor(2)" [style.height.px]="40" [style.width.px]="200"></div>
        </div>
        <div class="placeholder-row" [style.height.px]="40" [style.width.px]="80"></div>
      </div>

      <div class="placeholder" *ngFor="let i of [].constructor(10)" [style.height.px]="160"></div>
    </div>
    <div class="app-col-aside detachable"></div>
  </div>
</ng-template>
