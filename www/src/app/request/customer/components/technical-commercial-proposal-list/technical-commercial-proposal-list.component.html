<ng-container *ngIf="request$ | async"></ng-container>
<ng-container *ngIf="(stateStatus$ | async) !== 'fetching'; else placeholder">
  <div class="app-row">
    <div class="app-col">
      <div class="app-row">
        <uxg-tabs class="app-col">
          <uxg-tab-title #sentToReview [active]="true" >
            <ng-container *ngIf="(proposalsSentToReview$ | async) as proposalsSentToReview">
              Необходимо рассмотреть ({{proposalsSentToReview?.length}})
            </ng-container>
          </uxg-tab-title>
          <uxg-tab-title #reviewed>
            <ng-container *ngIf="(proposalsReviewed$ | async) as proposalsReviewed">
              Рассмотренные ({{ proposalsReviewed?.length }})
            </ng-container>
          </uxg-tab-title>
        </uxg-tabs>
        <!-- <button uxgButton secondary>Фильтр</button> -->
      </div>
      <br/>
      <ng-container *uxgTab="sentToReview">
        <app-request-technical-commercial-proposal
          #proposalsOnReview
          [chooseBy$]="chooseBy$"
          *ngFor="let positionProposals of proposalsSentToReview$ | async; trackBy: trackByPositionId"
          [requestId]="requestId"
          [group]="positionProposals">
        </app-request-technical-commercial-proposal>

        <div *ngIf="(proposalsSentToReview$ | async).length === 0">
          <h1 class="text-center" [style.opacity]="0.1">
            <br/>
            <clr-icon shape="app-publish" size="270"></clr-icon><br/>
            Все технико-коммерческие предложения рассмотрены
          </h1>
        </div>
      </ng-container>

      <ng-container *uxgTab="reviewed">
        <app-request-technical-commercial-proposal
          *ngFor="let positionProposals of proposalsReviewed$ | async; trackBy: trackByPositionId"
          [requestId]="requestId"
          [group]="positionProposals">
        </app-request-technical-commercial-proposal>
      </ng-container>
    </div>
    <div class="app-col-aside"></div>
  </div>
</ng-container>
<div class="proposals-footer" #proposalsFooterRef [class.hidden]="!sentToReview?.active || !(proposalsSentToReview$ | async)?.length">
  <div class="proposals-footer-body app-row app-align-items-center">
    <button uxgButton outline lg (click)="chooseBy$.next('price')">Автовыбор по цене</button>
    <button uxgButton outline lg (click)="chooseBy$.next('date')">Автовыбор по дате</button>
    <div class="app-col"></div>
    <h3 *ngIf="total > 0">
      <span class="app-ghost-color app-font-normal">Общая сумма: </span>
      <span>{{total | number: "1.0-2"}}</span>
      <span class="app-ghost-color">{{getCurrencySymbol('RUB', 'narrow') }}</span>
    </h3>
    <!-- @TODO: Ждем реализацию на бэкенде -->
    <!--<button uxgButton secondary lg (click)="rejectAll()" [disabled]="(stateStatus$ | async) !== 'received'">
      Отклонить всё
    </button>-->
    <button uxgButton primary lg (click)="approveAll()" [disabled]="!total || (stateStatus$ | async) !== 'received'">
      Согласовать всё
    </button>
  </div>
</div>
<ng-template #placeholder>
  <div class="app-row">
    <div class="app-col">
      <div class="app-row">
        <div class="app-col app-row">
          <div class="placeholder-row" *ngFor="let i of [].constructor(2)" [style.height.px]="40" [style.width.px]="200"></div>
        </div>
        <div class="placeholder-row" [style.height.px]="40" [style.width.px]="80"></div>
      </div>

      <div class="placeholder" *ngFor="let i of [].constructor(10)" [style.height.px]="160"></div>
    </div>
    <div class="app-col-aside"></div>
  </div>
</ng-template>
