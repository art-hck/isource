<div class="clr-row">
  <div class="clr-col-12 clr-col-xxl-9">

    <clr-datagrid class="requests-list-datagrid clr-row" (clrDgRefresh)="refresh($event)"
                  [clrDgLoading]="datagridLoader">
      <clr-dg-column class="request-number clr-col-1">
        Номер
      </clr-dg-column>
      <clr-dg-column class="request-published clr-col-2" *ngIf="requestStatus === 'NEW'">
        Опубликована
      </clr-dg-column>
      <clr-dg-column class="request-completed clr-col-2" *ngIf="requestStatus === 'COMPLETED'">
        Завершена
      </clr-dg-column>
      <clr-dg-column class="customer-name clr-col-2" *ngIf="customerNameColumnShow">
        Заказчик
      </clr-dg-column>
      <clr-dg-column class="request-name clr-col">
        Наименование
      </clr-dg-column>
      <clr-dg-column class="request-delivery-dates clr-col-3">
        Сроки поставки
      </clr-dg-column>
      <clr-dg-column class="position-count clr-col-1" *ngIf="requestStatus === 'NEW' || requestStatus === 'COMPLETED' || requestStatus === 'ON_CUSTOMER_APPROVAL'">
        Позиций
      </clr-dg-column>
      <clr-dg-column class="tasks clr-col-1" *ngIf="customerNameColumnShow && requestStatus === 'IN_PROGRESS'">
        Задач
      </clr-dg-column>
      <clr-dg-column class="request-completed-title clr-col" *ngIf="requestStatus === 'IN_PROGRESS'">
        Заверш/Поз.
      </clr-dg-column>
      <clr-dg-row *ngFor="let request of requests; let i = index" (click)="onRowClick(request)">
        <clr-dg-cell class="request-number clr-col-1 clr-align-self-center"><b>{{request.request.number}}</b>
        </clr-dg-cell>
        <clr-dg-cell class="published clr-col-2 clr-align-self-center" *ngIf="requestStatus === 'NEW'">

        </clr-dg-cell>
        <clr-dg-cell class="completed clr-col-2 clr-align-self-center" *ngIf="requestStatus === 'COMPLETED'">

        </clr-dg-cell>
        <clr-dg-cell class="customer-name clr-col-2 clr-align-self-center" *ngIf="customerNameColumnShow"
                     title="{{ request.request.contragent?.shortName }}">
          {{request.request.contragent?.shortName}}
        </clr-dg-cell>
        <clr-dg-cell class="request-name clr-col clr-align-self-center" title="{{ request.request.name }}">
          {{ request.request.name }}
        </clr-dg-cell>
        <clr-dg-cell class="request-delivery-dates clr-col-3 clr-align-self-center">
          <div class="request-dates">
          <span *ngIf="request.requestData.asapDeliveryDatePositionsCount">
            {{request.requestData.asapDeliveryDatePositionsCount}} как можно скорее
          </span>
            <span *ngIf="request.requestData.minDeliveryDate">
           {{ getDeliveryDate((request.requestData.minDeliveryDate | date:'dd.MM.yyyy'),
          (request.requestData.maxDeliveryDate | date:'dd.MM.yyyy'))}}
        </span>
          </div>
        </clr-dg-cell>
        <clr-dg-cell class="position-count clr-col-1 clr-align-self-center"
                     *ngIf="requestStatus === 'NEW' || requestStatus === 'COMPLETED' || requestStatus === 'ON_CUSTOMER_APPROVAL'">
         {{ request.requestData.positionsCount}}
        </clr-dg-cell>
        <clr-dg-cell class="request-tasks clr-col-1 clr-align-self-center"
                     *ngIf="customerNameColumnShow && requestStatus === 'IN_PROGRESS'">
          <span [ngClass]="{ 'light-grey' : request.requestData.tasksCount === 0}">
            {{request.requestData.tasksCount}}
          </span>
        </clr-dg-cell>
        <clr-dg-cell class="request-completed clr-col-1 clr-align-self-center" *ngIf="requestStatus === 'IN_PROGRESS'">
          <div class="pie-chart" *ngIf="!checkIfFreeFormRequest(request.request.type)">
            <svg width="20" height="20" class="chart">
              <circle r="10" cx="10" cy="10" class="pie"/>
              <circle r="10" cx="10" cy="10" class="pie" [attr.stroke-dashoffset]="calcPieChart(request)"/>
            </svg>
            <div>
              <span [ngClass]="{ 'light-grey' : request.requestData.completedPositionsCount === 0}">
                {{ request.requestData.completedPositionsCount}}
              </span>
              <span class="light-grey"> из</span> {{ request.requestData.positionsCount }}
            </div>
          </div>
        </clr-dg-cell>
      </clr-dg-row>

      <clr-dg-footer>
        <div class="clr-row" *ngIf="requests">

          <clr-dg-pagination #pagination
                             [clrDgTotalItems]="totalItems"
                             [clrDgPageSize]="pageSize"
          >
            <span class="light-grey">На странице заявки </span>
            {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}}
            <span class="light-grey"> из</span>
            {{ totalItems }}
            <clr-dg-page-size [clrPageSizeOptions]="[10,20,30]">
              <span class="grey">Показать на странице: </span>
            </clr-dg-page-size>
          </clr-dg-pagination>
        </div>
      </clr-dg-footer>
    </clr-datagrid>
  </div>
  <div class="clr-col-3 filter">
    <app-request-list-filter></app-request-list-filter>
  </div>
</div>

