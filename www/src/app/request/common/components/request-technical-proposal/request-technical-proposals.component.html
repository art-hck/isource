<div class="app-table tp-card">
  <div class="app-row">
    <div class="app-col">
      <div class="tp-header">
        <div class="app-col">
          <ng-container *ngIf="technicalProposal.supplierContragent; else noContragent">
            <h3>
              <app-contragent-info-link
                [contragent]="technicalProposal.supplierContragent">
              </app-contragent-info-link>
            </h3>
          </ng-container>

          <ng-template #noContragent><span>Отсутствует наименование контрагента</span></ng-template>
        </div>

        <div class="app-col app-col-aside status">
          <div [ngClass]="{'accepted': technicalProposal.status === 'ACCEPTED',
                           'declined': technicalProposal.status === 'DECLINED',
                           'draft': technicalProposal.status === 'NEW',
                           'onReview': technicalProposal.status === 'SENT_TO_REVIEW'}">
            <clr-icon shape="app-check" *ngIf="technicalProposal.status === 'ACCEPTED'"></clr-icon>
            <clr-icon shape="app-cross" *ngIf="technicalProposal.status === 'DECLINED'"></clr-icon>
            <clr-icon shape="app-doc" class="is-solid" *ngIf="technicalProposal.status === 'NEW'"></clr-icon>
            <clr-icon shape="app-warning" *ngIf="technicalProposal.status === 'SENT_TO_REVIEW'"></clr-icon>
            <b>{{ tpStatusLabel(technicalProposal) }}</b>
          </div>
          <button uxgButton link icon
                  *ngIf="featureService.available('editTechnicalProposal', userInfoService.roles)"
                  (click)="edit.emit(true)"
                  [disabled]="editDisabled(technicalProposal)">
            <clr-icon shape="app-pen"></clr-icon>
          </button>
          <button uxgButton link icon (click)="isFolded = !isFolded">
            <clr-icon shape="app-chevron" [attr.dir]="isFolded ? 'up':'down'"></clr-icon>
          </button>
        </div>
      </div>
      <div class="extendable-block" *ngIf="!isFolded">

        <!-- Секция докуметов ТП -->
        <div class="documents" *ngIf="technicalProposal.documents.length !== 0">
          <hr>
          <div class="section">
            <span class="upper-label">документы предложения</span>
            <app-document-simple-list
              [gridable]="true"
              [enableUpload]="false"
              [documents]="technicalProposal.documents">
            </app-document-simple-list>
          </div>
        </div>

        <!-- Секция списка позиций ТП -->
        <hr>
        <div class="app-row position-list section">
          <div class="app-col upper-label">Наименование позиции</div>
          <div class="app-col upper-label">Заводское наименование</div>
          <div class="app-col upper-label">Решение принято</div>
          <div class="app-col icon-status"></div>
        </div>
        <div class="app-row position-list" *ngFor="let technicalProposalPosition of technicalProposal.positions">
          <div class="app-col">{{ technicalProposalPosition.position.name }}</div>
          <div class="app-col">
            <ng-container *ngIf="technicalProposalPosition.manufacturingName; else noItem">
              <span class="grey">{{ technicalProposalPosition.manufacturingName }}</span>
            </ng-container>
          </div>
          <div class="app-col">
            <ng-container class="user" *ngIf="technicalProposalPosition.history; else noItem">
              {{ technicalProposalPosition.history?.user.shortName }}
              <span class="light-grey">
              {{ technicalProposalPosition.history?.createdDate | date:'shortDate' }}
            </span>
            </ng-container>
          </div>
          <div class="app-col icon-status">
            <clr-icon class="accepted"
                      shape="app-check"
                      *ngIf="technicalProposalPosition.status === 'ACCEPTED'"></clr-icon>
            <clr-icon class="declined"
                      shape="app-cross"
                      *ngIf="technicalProposalPosition.status === 'DECLINED'"></clr-icon>
          </div>
          <ng-template #noItem>
            <span class="light-grey">—</span>
          </ng-template>
        </div>


        <!-- Секция отмены отправки на согласование -->
<ng-container *ngIf="availableCancelPublishTechnicalProposal(technicalProposal)">
        <hr>
        <div class="app-row section">
          <div class="app-col">
            Вы можете отозвать отправленное на согласование заказчику ТП в течение ограниченного времени (таймер на кнопке).
          </div>
          <div class="app-col status">
            <button uxgButton primary type="button"
                    class="fixedWidth"
                    (click)="onCancelPublishTechicalProposal(technicalProposal)">
              Отозвать <span class="cancel-timer"> {{ technicalProposal.statusChangedDate | countdownTimer: durationCancelPublish }} </span>
            </button>
          </div>
        </div>
</ng-container>
      </div>
    </div>
  </div>
</div>
