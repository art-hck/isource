<ng-container *ngIf="!request" class="load-block">
  <span class="spinner spinner-md"></span>
</ng-container>
<ng-container *ngIf="request">
  <div class="clr-row">
    <div class="card"
         [ngClass]="{'clr-col-4' : (showPositionInfo || showRequestInfo)}"
         *ngIf="showPositionList">
      <div class="action-bar">
        <button class="btn btn-link" (click)="addNewPosition()" [disabled]="selectedIsNewPosition()">
          <clr-icon shape="plus-circle"></clr-icon>
          <span *ngIf="!(showPositionInfo || showRequestInfo)">Добавить позицию</span>
        </button>
        <button class="btn btn-link" (click)="onUploadPositionsFromExcel()">
          <clr-icon shape="upload"></clr-icon>
          <span *ngIf="!(showPositionInfo || showRequestInfo)">Загрузить из шаблона</span>
        </button>
      </div>

      <div class="card" *ngIf="showUploadPositionsFromExcelForm">
        <div class="card-block">
          <div class="card-text">
            <app-add-from-excel
              (submit)="onSendExcelFile($event)"
              [templateUrl]="'assets/RequestTemplate.xlsx'">
            </app-add-from-excel>
          </div>
        </div>
      </div>

      <div class="card-content">
        <app-request-position-list
          [request]="request"
          [requestPositions]="requestPositions"
          [selectedRequestPosition]="selectedRequestPosition"
          (selectedRequestPositionChange)="onSelectPosition($event)"
          [requestIsSelected]="showRequestInfo"
          (requestIsSelectedChange)="onSelectRequest($event)"
        ></app-request-position-list>
      </div>
    </div>

    <div class="info-card"
      [ngClass]="{'clr-col-8' : showPositionList, 'clr-col' : !showPositionList}"
      *ngIf="showRequestInfo || showPositionInfo">
      <app-request-info [request]="request"
                        [opened]="showRequestInfo"
                        (openedChange)="onCloseRequestInfo()"
                        (fullScreenChange)="showPositionList = !$event"
                        [isCustomerView]="isCustomerView">
      </app-request-info>

      <app-position-info [requestPosition]="selectedRequestPosition"
                         (requestPositionChanged)="onRequestPositionChanged($event)"
                         [opened]="showPositionInfo"
                         (openedChange)="onClosePositionInfo()"
                         [requestId]="requestId"
                         (fullScreenChange)="showPositionList = !$event"
                         (changeRequestInfo)="onUpdateRequestInfo()"
                         [isCustomerView]="isCustomerView"
                         [(positionInfoEditable)]="positionInfoEditable">
      </app-position-info>
    </div>
  </div>
</ng-container>
