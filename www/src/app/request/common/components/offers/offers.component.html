<div class="action-bar">
  <clr-tooltip>
    <button class="btn btn-link" clrTooltipTrigger
            (click)="onShowAddOfferForm()"
            role="tooltip"
            aria-haspopup="true"
            *ngIf="canAddOffer()">
      <clr-icon shape="add-text"></clr-icon>
    </button>
    <clr-tooltip-content clrPosition="top-right" clrSize="lg" *clrIfOpen>
      <span>Добавить коммерческое предложение</span>
    </clr-tooltip-content>
  </clr-tooltip>
</div>
<form [formGroup]="offerForm" class="form" *ngIf="showAddOfferForm">
  <div class="form-block">
    <div class="clr-form-control">
      <div class="clr-row w-100">
        <div class="clr-col-6">
          <label class="clr-control-label" for="supplierContragentName">Наименование к/а</label>
          <input id="supplierContragentName" type="text" formControlName="supplierContragentName"
                 [class.invalid]="isFieldValid('supplierContragentName')"/>
        </div>
        <div class="clr-col-2">
          <label class="clr-control-label" for="priceWithVat">Цена</label>
          <input type="number" id="priceWithVat" name="priceWithVat" formControlName="priceWithVat" min="0.1"
                 step="0.01" class="hidden-arrows text-right price"
                 [class.invalid]="isFieldValid('priceWithVat')">
        </div>
        <div class="clr-col-2">
          <label class="clr-control-label" for="currency">Валюта</label>
          <div class="select">
            <select name="currency" id="currency" formControlName="currency"
                    [class.invalid]="isFieldValid('currency')">
              <option value="RUB">
                RUB
              </option>
              <option value="USD">
                USD
              </option>
              <option value="EUR">
                EUR
              </option>
              <option value="CHF">
                CHF
              </option>
            </select>
          </div>
        </div>
      </div>
      <div class="clr-row w-100">
        <div class="clr-col-2">
          <label class="clr-control-label" for="quantity">Количество</label>
          <input type="number" id="quantity" name="quantity" formControlName="quantity" min="0"
                 step="0.01" class="hidden-arrows text-right price"
                 [class.invalid]="isFieldValid('quantity')">
        </div>
        <div class="clr-col-3">
          <label class="clr-control-label" for="measureUnit">Единицы измерения</label>
          <input type="text" name="measureUnit" id="measureUnit" formControlName="measureUnit"
                 [class.invalid]="isFieldValid('measureUnit')">
        </div>
        <div class="clr-col-2">
          <label class="clr-control-label" for="deliveryDate">Cрок поставки</label>
          <input id="deliveryDate" placeholder="дд.мм.гггг" type="date" clrDate
                 formControlName="deliveryDate"
                 [class.invalid]="isFieldValid('deliveryDate')"/>
        </div>
        <div class="clr-col-5">
          <label class="clr-control-label" for="paymentTerms">Условия оплаты</label>
          <input type="text" id="paymentTerms" formControlName="paymentTerms"
                 [class.invalid]="isFieldValid('paymentTerms')">
        </div>
      </div>
      <div class="clr-row w-100 right-align-button">
        <button class="btn btn-outline" (click)="onAddOffer()" [disabled]="offerForm.invalid">Добавить</button>
      </div>
    </div>
  </div>
</form>

<clr-datagrid class="clr-row" *ngIf="requestPosition.linkedOffers.length !== 0">
  <clr-dg-column class="clr-col-3">Наименование к/а</clr-dg-column>
  <clr-dg-column class="clr-col-1">Цена</clr-dg-column>
  <clr-dg-column class="clr-col-1">Количество</clr-dg-column>
  <clr-dg-column class="clr-col-1">Дата поставки</clr-dg-column>
  <clr-dg-column class="clr-col-2">Условия оплаты</clr-dg-column>
  <clr-dg-column class="clr-col-2">КП</clr-dg-column>
  <clr-dg-column class="clr-col-1">ТП</clr-dg-column>
  <clr-dg-column class="clr-col-1" *ngIf="isCustomerView">Победитель</clr-dg-column>

  <clr-dg-row *ngFor="let linkedOffer of requestPosition.linkedOffers">
    <clr-dg-cell class="clr-col-3 offer">{{linkedOffer.supplierContragentName}}
    </clr-dg-cell>
    <clr-dg-cell class="clr-col-1 offer">{{linkedOffer.priceWithVat}}<span>{{linkedOffer.currency}}</span>
    </clr-dg-cell>
    <clr-dg-cell class="clr-col-1 offer">{{linkedOffer.quantity}}<span>{{linkedOffer.measureUnit}}</span></clr-dg-cell>
    <clr-dg-cell class="clr-col-1 offer">{{linkedOffer.deliveryDate | date :'shortDate'}}</clr-dg-cell>
    <clr-dg-cell class="clr-col-2 offer">{{linkedOffer.paymentTerms}}</clr-dg-cell>
    <clr-dg-cell class="clr-col-2">
      <app-document-simple-list
        [enableUpload]="!isCustomerView"
        [documents]="linkedOffer.documents"
        (selected)="onUploadDocuments($event, linkedOffer)"
      ></app-document-simple-list>
    </clr-dg-cell>
    <clr-dg-cell class="clr-col-1">
      <button class="btn btn-link download" *ngIf="!isCustomerView">Загрузить</button>
    </clr-dg-cell>
    <clr-dg-cell class="clr-col-1" *ngIf="isCustomerView">
      <input type="radio" clrRadio [(ngModel)]="offerWinnerId"
             value="{{linkedOffer.id}}"
             (change)="winnerChoice(linkedOffer)"
             *ngIf="isCustomerView"
             [disabled]="!canChoiceWinner()"/>
    </clr-dg-cell>
  </clr-dg-row>
</clr-datagrid>
<ng-container *ngIf="!requestPosition.linkedOffers || requestPosition.linkedOffers.length === 0">
  <div class="clr-row no-offers">
    <p>Коммерческие предложения по позиции отсутствуют</p>
  </div>
</ng-container>

