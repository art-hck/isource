<div class="container">
  <h2 class="newRequest">Новая заявка</h2>
  <form [formGroup]="requestDataForm" class="form">
    <div formArrayName="itemForm">
      <div *ngFor="let item of requestDataForm['controls'].itemForm['controls']; let i=index">
        <div formGroupName="{{i}}" class="i">
          <div class="card">
            <div class="card-block">
              <div class="card-text">
                <div class="form-block">
                  <div class="clr-row" *ngIf="!showForm[i]" (click)="onEditForm(i)">
                    <div class="clr-col-11 title">
                      {{item.get('name').value}}
                    </div>
                    <div class="clr-col-1">
                      <button type="button" class="btn btn-link delete" (click)="deleteItem(i)">
                        <clr-icon shape="times"></clr-icon>
                      </button>
                    </div>
                  </div>
                  <div class="clr-form-control" *ngIf="showForm[i]">
                    <label class="clr-control-label" for="name">Наименование МТР</label>
                    <input type="text" id="name" formControlName="name" [class.invalid]="isFieldValid(i, 'name')">
                    <label class="clr-control-label" for="productionDocument">
                      Документ, в соответствии с которым необходимо изготовление (НТД: ГОСТ/ТУ, ТЗ, ОЛ, ЗТП и т.п.)
                    </label>
                    <input type="text" id="productionDocument" formControlName="productionDocument"
                           [class.invalid]="isFieldValid(i, 'productionDocument')">
                    <div class="clr-row w-100">
                      <div class="clr-col-3">
                        <label class="clr-control-label" for="quantity">Количество</label>
                        <input type="number" id="quantity" name="quantity" formControlName="quantity" min="0"
                               step="0.01" class="hidden-arrows text-right price"
                               [class.invalid]="isFieldValid(i, 'quantity')">
                      </div>
                      <div class="clr-col-3">
                        <label class="clr-control-label" for="measureUnit">Единицы измерения</label>
                        <div class="select">
                          <input type="text" name="measureUnit" id="measureUnit" formControlName="measureUnit"
                                 [class.invalid]="isFieldValid(i, 'measureUnit')">
                        </div>
                      </div>
                      <div class="clr-col-3">
                        <label class="clr-control-label" for="deliveryDate"> Необходимый срок поставки</label>
                        <input id="deliveryDate" placeholder="ДД.ММ.ГГГГ" type="date" clrDate
                               formControlName="deliveryDate"
                               [class.invalid]="isFieldValid(i, 'deliveryDate')"/>
                      </div>
                      <div class="clr-col-3 isDeliveryAsap">
                        <clr-checkbox-wrapper>
                          <input type="checkbox" clrCheckbox name="isDeliveryDateAsap" id="isDeliveryDateAsap"
                                 formControlName="isDeliveryDateAsap"
                                 [class.invalid]="isFieldValid(i, 'isDeliveryDateAsap')">
                          <label>как можно быстрее</label>
                        </clr-checkbox-wrapper>
                      </div>
                    </div>
                    <label class="clr-control-label" for="deliveryBasis">Базис поставки (пункт, до которого требуется
                      доставка)</label>
                    <input type="text" id="deliveryBasis" formControlName="deliveryBasis"
                           [class.invalid]="isFieldValid(i, 'deliveryBasis')">
                    <label class="clr-control-label" for="paymentTerms">Условия оплаты</label>
                    <input type="text" id="paymentTerms" formControlName="paymentTerms"
                           [class.invalid]="isFieldValid(i, 'paymentTerms')">
                    <div class="clr-row w-100">
                      <div class="clr-col-3">
                        <label class="clr-control-label" for="startPrice">Начальная максимальная цена</label>
                        <input type="number" id="startPrice" name="startPrice" formControlName="startPrice" min="0.1"
                               step="0.01" class="hidden-arrows text-right price"
                               [class.invalid]="isFieldValid(i, 'startPrice')">
                      </div>
                      <div class="clr-col-3">
                        <label class="clr-control-label" for="currency">Валюта</label>
                        <div class="select">
                          <select name="currency" id="currency" formControlName="currency">
                            <option (value)="RUB">
                              RUB
                            </option>
                            <option (value)="USD">
                              USD
                            </option>
                            <option (value)="EUR">
                              EUR
                            </option>
                            <option (value)="CHF">
                              CHF
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <label class="clr-control-label nopadding" for="relatedServices">Необходимость сопутствующих услуг
                      (ШМР,
                      ПНР)</label>
                    <input type="text" id="relatedServices" name="relatedServices" formControlName="relatedServices">
                    <label class="clr-control-label" for="comments">Примечания/комментрии</label>
                    <textarea type="textarea" id="comments" name="comments" formControlName="comments"></textarea>
                    <div class="card-footer">
                      <button type="button" class="btn btn-outline" (click)="onAddToList(i)" *ngIf="showAddToList"
                              [disabled]="requestDataForm.invalid">
                        Добавить в список
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
  <div class="addNext">
    <button type="button" class="btn btn-link" (click)="onAddNext()" *ngIf="canAddItems()">
      Добавить
    </button>
  </div>
  <div class="submit">
    <button type="button" class="btn btn-primary" (click)="onAddRequest()" [disabled]="requestDataForm.invalid">
      Отправить
    </button>
  </div>
</div>
