<form (ngSubmit)="submit()" >
  <div class="paymentTerms">
    <label class="input-label">Условия оплаты</label>
    <uxg-dropdown placeholder="Условия оплаты" [formControl]="paymentTermsControl">
      <div uxgDropdownItem *ngFor="let term of paymentTerms" [value]="term[0]">{{term[1]}}</div>
    </uxg-dropdown>
  </div>

  <div class="divider"></div>
  <div class="parameters">
    <ng-container *ngFor="let form of formArray?.controls" [formGroup]="form">
      <p class="app-bold">{{ form.get("name").value }}</p>
      <div class="app-row section">
        <div class="app-col">
          <input uxgInput formControlName="priceWithoutVat" placeholder="Цена за единицу"/>
        </div>
        <div class="app-col">
          <input uxgInput formControlName="quantity" placeholder="Количество" type="number" [warning]="!isQuantityValid(form)"/>
        </div>
        <div class="app-col">

          <uxg-dropdown-input appSuggestions strictMode formControlName="measureUnit" placeholder="Ед. измерения"
            [$]="okeiList$" [searchFn]="okeiService.searchOkei" #okei="appSuggestions" [appControlWrap]="false"
          >
            <ng-container *ngIf="(okei.suggestions$ | async) as okeiSuggestions">
              <div uxgDropdownItem *ngFor="let suggestion of okeiSuggestions"
                   [value]="suggestion.symbol | lowercase"
                   [attr.title]="suggestion.name | lowercase"
              >{{suggestion.symbol | lowercase }} <span class="app-ghost-color">- {{suggestion.name | lowercase}}</span></div>
            </ng-container>
            <ng-template #errors>
              <div class="app-control-error" *ngIf="form.get('measureUnit').errors as e">
                <span *ngIf="e.required">Обязательное поле</span>
                <span *ngIf="e.notFromList">Выберите значение из списка</span>
              </div>
            </ng-template>

          </uxg-dropdown-input>
        </div>
        <div class="app-col">
          <uxg-dropdown placeholder="Валюта" formControlName="currency">
            <div uxgDropdownItem [value]="currency[0]" *ngFor="let currency of currencies">{{ currency[1] }}</div>
          </uxg-dropdown>
        </div>
        <div class="app-col">
          <div style="position: relative">
            <input #deliveryDate uxgInput uxgDatepicker formControlName="deliveryDate" placeholder="Дата" [warning]="!isDateValid(form)"/>
            <label class="app-control-icon" (click)="deliveryDate.focus()">
              <uxg-icon shape="app-calendar-big" size="24"></uxg-icon>
            </label>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="divider"></div>
  <div class="app-row app-uppercase app-ghost-color app-bold section">
    <div class="app-col"><small>Цена за единицу</small></div>
    <div class="app-col"><small class="app-uppercase app-ghost-color">Количество</small></div>
    <div class="app-col"><small class="app-uppercase app-ghost-color">Ед. измерения</small></div>
    <div class="app-col"><small class="app-uppercase app-ghost-color">Валюта</small></div>
    <div class="app-col"><small class="app-uppercase app-ghost-color"></small></div>
  </div>
  <div class="app-row app-justify-content-end">
    <button uxgButton lg secondary type="button" (click)="cancel.emit()">Отмена</button>
    <button uxgButton lg primary [disabled]="formArray?.invalid">Сохранить</button>
  </div>
</form>
